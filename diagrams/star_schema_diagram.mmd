erDiagram
    %% =========================================================
    %% STAR SCHEMA - PRODUÇÃO POR AUTORIA E TEMA (DW OESNPG)
    %% =========================================================

    fact_producao_tema {
        int     producao_tema_id PK "Chave surrogate da fato"
        bigint  producao_id "ID da produção (negócio)"
        int     tempo_sk FK "Data/ano base"
        int     tema_sk FK "Tema/macrotema associado"
        int     ods_sk FK "ODS (quando houver)"
        int     ppg_sk FK "Programa de pós-graduação"
        int     ies_sk FK "Instituição"
        int     docente_sk FK "Autor docente"
        int     discente_sk FK "Autor discente"
        int     titulado_sk FK "Autor egresso"
        int     posdoc_sk FK "Autor pós-doc"
        varchar tipo_autor "Categoria do autor no registro"
        int     ordem_autor "Posição do autor na lista"
        int     qtd_autores "Autores contados (sempre 1)"
        int     qtd_producoes "Produções contadas (sempre 1)"
        int     ano_base "Ano base da autoria"
        varchar fonte_dados "Origem (add_producao_autor)"
        timestamp created_at "Timestamp de carga"
    }

    dim_tempo {
        int       tempo_sk PK "Chave surrogate temporal"
        date      data "Data completa"
        int       ano "Ano"
        int       semestre "Semestre"
        int       trimestre "Trimestre"
        int       mes "Mês"
        int       dia "Dia"
        varchar   dia_semana "Nome do dia"
        varchar   fim_de_semana "S ou N"
    }

    dim_tema {
        int     tema_sk PK "Chave surrogate"
        int     macrotema_id "ID macrotema"
        varchar macrotema_nome "Nome macrotema"
        int     tema_id "ID tema CAPES"
        varchar tema_nome "Descrição do tema"
        int     palavrachave_id "ID palavra-chave"
        varchar palavra_chave "Descrição da palavra-chave"
        varchar sigla_uf "UF curadoria"
        timestamp created_at "Timestamp de carga"
    }

    dim_ppg {
        int     ppg_sk PK "Chave surrogate"
        varchar codigo_programa "Código CAPES"
        varchar nome_programa "Nome do PPG"
        varchar modalidade "Acadêmico/Profissional"
        varchar situacao "Situação CAPES"
        numeric nota_capes "Nota CAPES"
        varchar area_avaliacao "Área de avaliação"
        varchar grande_area "Grande área"
        int     ies_sk FK "Ref. para dim_ies"
        varchar uf "UF do programa"
        varchar regiao "Região"
    }

    dim_ies {
        int     ies_sk PK "Chave surrogate"
        bigint  cod_entidade_capes "Código CAPES"
        varchar nome_ies "Nome oficial"
        varchar sigla_ies "Sigla"
        varchar categoria_adm "Pública/Privada"
        varchar organizacao_academica "Universidade, IF, etc."
        varchar uf "UF"
        varchar municipio "Município"
        varchar regiao "Região"
    }

    dim_docente {
        int     docente_sk PK "Chave surrogate"
        bigint  id_pessoa "ID pessoa CAPES"
        varchar nome_docente "Nome completo"
        varchar categoria "Categoria no PPG"
        varchar regime_trabalho "DE, 40h, 20h..."
        varchar possui_doutorado "S/N"
        varchar area_avaliacao "Área CAPES"
        varchar uf_programa "UF do programa"
    }

    dim_discente {
        int     discente_sk PK "Chave surrogate"
        bigint  id_discente "ID discente CAPES"
        bigint  id_pessoa "ID pessoa"
        varchar nome_discente "Nome completo"
        varchar grau_academico "Mestrado/Doutorado"
        varchar situacao "Situação no programa"
        date    data_matricula "Data de ingresso"
    }

    dim_titulado {
        int     titulado_sk PK "Chave surrogate"
        bigint  id_pessoa "ID pessoa"
        varchar nome_titulado "Nome do egresso"
        int     ano_titulacao "Ano de titulação"
        varchar grau "Grau obtido"
        varchar tema_trabalho "Tema da dissertação/tese"
    }

    dim_posdoc {
        int     posdoc_sk PK "Chave surrogate"
        bigint  id_pessoa "ID pessoa"
        varchar nome_posdoc "Nome do pós-doutor"
        varchar instituicao_origem "Instituição de origem"
        date    inicio_estagio "Início do estágio"
        date    fim_estagio "Fim do estágio"
    }

    dim_ods {
        int     ods_sk PK "Chave surrogate"
        int     numero_ods "ODS 1..17"
        varchar nome_ods "Título traduzido"
        varchar meta_principal "Meta principal"
        varchar descricao "Descrição resumida"
    }

    %% =========================================================
    %% RELACIONAMENTOS (FKS)
    %% =========================================================
    fact_producao_tema ||--|| dim_tempo : "tempo_sk"
    fact_producao_tema ||--|| dim_tema : "tema_sk"
    fact_producao_tema ||--o{ dim_ppg : "ppg_sk"
    fact_producao_tema ||--o{ dim_ies : "ies_sk"
    fact_producao_tema ||--o{ dim_docente : "docente_sk"
    fact_producao_tema ||--o{ dim_discente : "discente_sk"
    fact_producao_tema ||--o{ dim_titulado : "titulado_sk"
    fact_producao_tema ||--o{ dim_posdoc : "posdoc_sk"
    fact_producao_tema ||--o{ dim_ods : "ods_sk"

    dim_ppg ||--|| dim_ies : "ies_sk"

    %% =========================================================
    %% OBSERVAÇÕES
    %% =========================================================
    %%{
        note: "Status de implementação (Out/2025)"
        note: "• fact_producao_tema, dim_tempo e dim_tema já carregadas."
        note: "• dim_ppg, dim_ies, dim_docente, dim_discente, dim_titulado e"
        note: "  dim_posdoc estão em desenvolvimento (valores de SK=0 enquanto"
        note: "  dimensões não forem populadas)."
        note: "• O relacionamento com dim_ods depende da fact_tema_ods."
*** End Patch
