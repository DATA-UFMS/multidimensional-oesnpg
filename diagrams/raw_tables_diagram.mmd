```mermaid
erDiagram
    %% =====================================================
    %% CAMADA RAW ATUAL - FONTES PADRONIZADAS PARA O DW OESNPG
    %% Atualizado em: 16/10/2025
    %% =====================================================

    raw_ies {
        bigint _id_original PK "Identificador da API CAPES"
        bigint cod_entidade_capes "Código CAPES da IES"
        bigint cod_entidade_emec "Código e-MEC (quando disponível)"
        text   sg_entidade_ensino "Sigla oficial da instituição"
        text   des_entidade_ensino "Nome completo da instituição"
        text   cs_status_juridico "Público, Privado, etc."
        text   des_dependencia_administrativa "Federal, Estadual..."
        text   des_regiao "Região geográfica"
        text   sg_uf_programa "UF de referência"
        text   des_municipio_programa_ies "Município do programa"
        text   cod_programa_ies "Código do programa associado"
        text   des_programa_ies "Nome do programa associado"
        text   des_situacao_programa "Situação na CAPES"
        text   dt_situacao_programa "Data da última atualização"
        bigint an_base "Ano base do snapshot"
    }

    raw_ppg {
        integer id PK "Surrogate interno"
        integer ano_base "Ano base do CSV"
        integer codigo_capes_da_ies "Código CAPES da IES"
        text    codigo_do_ppg "Código CAPES do PPG"
        text    nome_ppg "Nome do PPG"
        text    modalidade_do_ppg "Acadêmico / Profissional"
        text    situacao_do_ppg "Situação atual"
        numeric nota_do_ppg "Nota CAPES (3-7)"
        integer codigo_grande_area_do_ppg "Código grande área"
        integer codigo_area_de_conhecimento_do_ppg "Código área"
        integer quantidade_de_docentes_no_ppg "Docentes"
        integer quantidade_de_discentes_matriculados_no_ppg "Discentes"
        text    fonte_arquivo "ppg_2024.csv"
        timestamp created_at "Timestamp de carga"
    }

    raw_docente {
        bigint  id_pessoa "Identificador CAPES do docente"
        text    nm_docente "Nome completo"
        integer ano_base "Ano base da coleta"
        text    sg_entidade_ensino "Sigla da IES"
        text    nm_entidade_ensino "Nome da IES"
        text    ds_categoria_docente "Categoria (Perm, Colab...)"
        text    in_doutor "Possui doutorado (S/N)"
        integer cd_programa_ies "Código do PPG"
        text    nm_programa_ies "Nome do PPG"
        text    nm_area_avaliacao "Área de avaliação CAPES"
        text    sg_uf_programa "UF do programa"
        text    nm_regiao "Região"
        text    nm_modalidade_programa "Modalidade do PPG"
        integer cd_entidade_capes "Código CAPES da IES"
        text    fonte_arquivo "Arquivo CSV de origem"
        timestamp created_at "Timestamp de carga"
    }

    raw_tema {
        integer macrotema_id "Código do macrotema"
        text    macrotema_nome "Nome do macrotema"
        integer tema_id "Código do tema"
        text    tema_nome "Descrição do tema"
        integer palavrachave_id "Código da palavra-chave"
        text    palavrachave_nome "Descrição da palavra-chave"
        text    uf "UF associada"
        text    fonte_arquivo "Arquivo Excel origem"
        timestamp created_at "Timestamp de carga"
    }

    raw_producao_autor {
        bigint  id_add_producao_intelectual PK "ID da produção"
        integer an_base_producao "Ano base da produção"
        integer id_tipo_producao "Tipo (bibliográfica, técnica...)"
        integer id_subtipo_producao "Subtipo do tipo"
        text    cd_programa "Código CAPES do PPG"
        text    nm_programa "Nome do PPG"
        text    sg_ies "Sigla da IES"
        text    nm_ies "Nome da IES"
        bigint  id_pessoa_docente "ID pessoa (docente)"
        bigint  id_pessoa_discente "ID pessoa (discente)"
        bigint  id_pessoa_pos_doc "ID pessoa (pós-doc)"
        bigint  id_pessoa_egresso "ID pessoa (egresso)"
        text    tp_autor "Categoria do autor no registro"
        integer nr_ordem "Ordem do autor"
        text    nm_abnt_autor "Nome formatado (ABNT)"
        text    nm_area_conhecimento "Área do conhecimento"
        timestamp dt_carga "Timestamp do arquivo"
    }

    %% =====================================================
    %% RELACIONAMENTOS LÓGICOS UTILIZADOS NO ETL
    %% =====================================================

    raw_ies ||--o{ raw_ppg : "cod_entidade_capes = codigo_capes_da_ies"
    raw_ies ||--o{ raw_docente : "cod_entidade_capes = cd_entidade_capes"
    raw_ppg ||--o{ raw_docente : "codigo_do_ppg = cd_programa_ies::text"
    raw_ppg ||--o{ raw_producao_autor : "codigo_do_ppg = cd_programa"
    raw_docente ||--o{ raw_producao_autor : "id_pessoa_docente ↔ ID_PESSOA_DOCENTE"

    %% Dimensão tema é carregada separadamente a partir de planilha curada.
    raw_tema ||--o{ raw_producao_autor : "futura ligação por palavras-chave (matching)"

    %% =====================================================
    %% NOTAS
    %% =====================================================
    %%{
        note: "Volumes atuais"
        note: "• raw_ies: 3.568 registros (API CAPES add_capes)"
        note: "• raw_ppg: 4.635 registros (CSV ppg_2024)"
        note: "• raw_docente: 254.175 registros consolidados (2021-2023)"
        note: "• raw_tema: 5.991 registros (macro_temas_oesnpg_v2.xlsx)"
        note: "• raw_producao_autor: 2.948.232 autorias (parquet add_producao_autor_2023)"
        note: ""
        note: "Relacionamentos representam chaves lógicas utilizadas na geração"
        note: "das dimensões e da nova fato fact_producao_tema."
        note: ""
        note: "Padronização Aplicada:"
        note: "• codigo → cod"
        note: "• nome_ → des_"
        note: "• ds_ → des_"
        note: "• cd_ → cod_"
        note: "• _id → _original"
        note: "• quantidade → qtd"
        note: "• Snake_case, sem acentos"
        note: ""
        note: "Relacionamentos para ETL:"
        note: "• Por UF (sg_uf_programa, uf, sigla_uf_programa, des_uf)"
        note: "• Por IES (des_entidade_ensino, nome_ies, des_instituicao_nome)"
        note: "• Por Programa (cod_programa_ies, codigo_programa_ies)"
        note: "• Por Região (des_regiao, nome_regiao, regiao)"
        note: "• Por Grande Área (des_grande_area_conhecimento, des_grande_area)"
        note: "• Por ID Lattes (raw_pq.id_lattes para cruzamento com docentes)"
    %%}
```
